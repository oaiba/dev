# Tên của workflow
name: Build and Deploy Hugo to gh-pages branch

# Kích hoạt workflow khi có push vào nhánh `main`
on:
  push:
    branches:
      - main

# Cấp quyền cho workflow để ghi (push) vào nhánh gh-pages
permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout code từ nhánh `main`, bao gồm cả theme (submodule)
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true
          fetch-depth: 0

      # 2. Cài đặt Hugo (bản extended)
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'
          extended: true

      # 3. Build trang web và tối ưu hóa
      - name: Build
        run: hugo --minify

      # 4. Deploy các tệp trong thư mục /public vào nhánh `gh-pages`
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v4
        with:
          # Token để xác thực việc push code
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # Thư mục chứa các tệp đã build để deploy
          publish_dir: ./public
          # Tên nhánh để deploy (mặc định là gh-pages, nhưng ghi rõ ra sẽ tường minh hơn)
          publish_branch: gh-pages
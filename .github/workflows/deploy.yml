# Tên của workflow, sẽ hiển thị trong tab "Actions" trên GitHub
name: Deploy Hugo site to GitHub Pages

# Điều kiện để kích hoạt workflow
on:
  # Chạy khi có một push mới vào nhánh `main`
  push:
    branches:
      - main  # Hoặc 'master' tùy vào tên nhánh chính của bạn

  # Cho phép chạy workflow này thủ công từ tab Actions
  workflow_dispatch:

# Cấp quyền cho workflow để ghi vào GitHub Pages (bảo mật hơn)
permissions:
  contents: read
  pages: write
  id-token: write

# Hủy bỏ các lần chạy cũ đang chờ xử lý của workflow này để tránh xung đột
concurrency:
  group: "pages"
  cancel-in-progress: true

# Chia workflow thành 2 công việc (jobs) riêng biệt: build và deploy
jobs:
  # Job 1: Build trang web Hugo
  build:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout code của bạn, bao gồm cả theme (submodule)
      - name: Checkout
        uses: actions/checkout@v4
        with:
          submodules: true  # Rất quan trọng để tải cả theme
          fetch-depth: 0    # Cần thiết cho các theme có thể cần lịch sử git

      # 2. Cài đặt Hugo phiên bản mới nhất (bản extended)
      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: 'latest'
          extended: true

      # 3. Build trang web và tối ưu hóa (minify)
      - name: Build
        run: hugo --minify

      # 4. Tải lên các tệp đã build để job 'deploy' có thể sử dụng
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # Tự động tải lên từ thư mục 'public'
          path: ./public

  # Job 2: Deploy trang web lên GitHub Pages
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build # Job này chỉ chạy sau khi job 'build' hoàn thành
    steps:
      # Deploy lên GitHub Pages bằng Action chính thức
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4